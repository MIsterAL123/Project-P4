<!-- Guru Konfirmasi Pendaftaran Pelatihan -->
<div class="p-4 md:p-6">
  <!-- Page Header -->
  <div class="flex items-center mb-6">
    <a href="/guru/daftar-pelatihan" class="mr-4 text-gray-600 hover:text-gray-900">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
    </a>
    <div>
      <h1 class="text-2xl font-bold text-gray-800">Konfirmasi Pendaftaran Pelatihan</h1>
      <p class="text-gray-600 mt-1">Periksa detail pelatihan sebelum mendaftar</p>
    </div>
  </div>

  <!-- Alert Messages -->
  <% if (typeof error !== 'undefined' && error) { %>
  <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline"><%= error %></span>
  </div>
  <% } %>

  <% if (kuota) { %>
  <div class="max-w-2xl mx-auto">
    <!-- Pelatihan Info Card -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">
        <%= kuota.judul_pelatihan || 'Pelatihan ' + kuota.tahun_ajaran %>
      </h2>
      
      <div class="space-y-3 text-gray-600">
        <% if (kuota.deskripsi) { %>
        <p><%= kuota.deskripsi %></p>
        <% } %>
        
        <div class="grid grid-cols-2 gap-4 pt-4 border-t">
          <div>
            <p class="text-sm text-gray-500">Periode</p>
            <p class="font-medium">
              <% if (kuota.tanggal_mulai && kuota.tanggal_selesai) { %>
              <%= new Date(kuota.tanggal_mulai).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %>
              <br>s/d <%= new Date(kuota.tanggal_selesai).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %>
              <% } else { %>
              <%= kuota.tahun_ajaran %>
              <% } %>
            </p>
          </div>
          <% if (kuota.waktu_pelatihan) { %>
          <div>
            <p class="text-sm text-gray-500">Waktu</p>
            <p class="font-medium"><%= kuota.waktu_pelatihan %></p>
          </div>
          <% } %>
          <div>
            <p class="text-sm text-gray-500">Kuota Tersedia</p>
            <p class="font-medium"><%= kuota.max_peserta - (kuota.peserta_terdaftar || 0) %> dari <%= kuota.max_peserta %> peserta</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Status</p>
            <p class="font-medium">
              <% if (kuota.status === 'open') { %>
              <span class="text-green-600">Dibuka</span>
              <% } else { %>
              <span class="text-red-600">Ditutup</span>
              <% } %>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Registration Form -->
    <% if (!alreadyRegistered && canRegister && kuota.status === 'open') { %>
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Konfirmasi Pendaftaran</h3>
      
      <div class="bg-blue-50 border border-blue-200 rounded p-4 mb-6">
        <div class="flex">
          <svg class="w-5 h-5 text-blue-600 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div class="text-sm text-blue-800">
            <p class="font-medium">Informasi Pendaftaran</p>
            <ul class="mt-1 list-disc list-inside">
              <li>Anda dapat mendaftar maksimal 3 pelatihan per tahun</li>
              <li>Pendaftaran tahun ini: <%= registrationsThisYear %> / <%= maxRegistrations %></li>
              <li>Pastikan data profil Anda sudah lengkap dan benar</li>
              <li>Silakan unggah <strong>Surat Tugas</strong> di bawah ini sebagai syarat pendaftaran (PDF, JPG, PNG, maks 5MB)</li>
            </ul>
          </div>
        </div>
      </div>

      <form action="/guru/konfirmasi-pendaftaran/<%= kuota.id %>" method="POST" enctype="multipart/form-data">
        <div class="mb-4">
          <label for="surat_tugas" class="block text-sm font-medium text-gray-700 mb-2">
            Upload Surat Tugas <span class="text-red-500">*</span>
          </label>
          <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 transition-colors">
            <div class="space-y-1 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div class="flex text-sm text-gray-600">
                <label for="surat_tugas" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none">
                  <span>Upload file</span>
                  <input id="surat_tugas" name="surat_tugas" type="file" class="sr-only" required accept=".pdf,.jpg,.jpeg,.png" onchange="updateFileName(this, 'fileNameGuru')">
                </label>
                <p class="pl-1">atau drag and drop</p>
              </div>
              <p class="text-xs text-gray-500">PDF, JPG, PNG maksimal 5MB</p>
              <p id="fileNameGuru" class="text-sm text-blue-600 font-medium mt-2"></p>
              <p id="fileErrorGuru" class="text-sm text-red-600 mt-2"></p>
            </div>
          </div>
          <p class="mt-2 text-xs text-gray-500">Surat tugas yang telah ditandatangani oleh Kepala Sekolah/Pimpinan Instansi</p>
        </div>

      <script>
      (function(){
        const form = document.querySelector('form[action^="/guru/konfirmasi-pendaftaran/"]');
        const input = document.getElementById('surat_tugas');
        const fileError = document.getElementById('fileErrorGuru');
        const MAX_SIZE = 5 * 1024 * 1024; // 5MB
        const allowed = /\.(pdf|jpe?g|png)$/i;

        form.addEventListener('submit', function(e){
          fileError.textContent = '';
          if (!input.files || !input.files[0]) {
            fileError.textContent = 'Silakan pilih file Surat Tugas';
            e.preventDefault();
            return;
          }
          const f = input.files[0];
          if (!allowed.test(f.name)) {
            fileError.textContent = 'Tipe file tidak diizinkan. Gunakan PDF, JPG, atau PNG.';
            e.preventDefault();
            return;
          }
          if (f.size > MAX_SIZE) {
            fileError.textContent = 'Ukuran file melebihi batas 5MB.';
            e.preventDefault();
            return;
          }
        });

        // Hook into existing onchange
        input.addEventListener('change', function(){
          const fileName = document.getElementById('fileNameGuru');
          if (this.files && this.files[0]) {
            fileName.textContent = 'File dipilih: ' + this.files[0].name;
          } else {
            fileName.textContent = '';
          }
          fileError.textContent = '';
        });
      })();
      </script>

        <div class="mb-4">
          <label class="flex items-start">
            <input type="checkbox" name="agree" required class="mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
            <span class="ml-2 text-sm text-gray-600">
              Saya menyatakan bahwa data yang saya berikan adalah benar dan saya bersedia mengikuti seluruh rangkaian pelatihan sesuai jadwal yang telah ditentukan.
            </span>
          </label>
        </div>

        <div class="flex flex-col sm:flex-row gap-3">
          <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            Daftar Sekarang
          </button>
          <a href="/guru/daftar-pelatihan" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-center">
            Batal
          </a>
        </div>
      </form>

      <script>
      function updateFileName(input, targetId) {
        const fileName = document.getElementById(targetId);
        if (input.files && input.files[0]) {
          fileName.textContent = 'File dipilih: ' + input.files[0].name;
        } else {
          fileName.textContent = '';
        }
      }
      </script>
    </div>
    <% } else if (alreadyRegistered) { %>
    <div class="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
      <svg class="w-12 h-12 mx-auto text-green-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 class="text-lg font-medium text-green-800 mb-2">Anda Sudah Terdaftar</h3>
      <p class="text-green-700 mb-4">Anda sudah terdaftar pada pelatihan ini.</p>
      <a href="/guru/status-pendaftaran" class="text-green-600 hover:text-green-800 font-medium">
        Lihat Status Pendaftaran â†’
      </a>
    </div>
    <% } else if (!canRegister) { %>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
      <svg class="w-12 h-12 mx-auto text-yellow-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
      </svg>
      <h3 class="text-lg font-medium text-yellow-800 mb-2">Batas Pendaftaran Tercapai</h3>
      <p class="text-yellow-700">Anda sudah mencapai batas maksimal pendaftaran (3x per tahun).</p>
    </div>
    <% } else { %>
    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center">
      <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
      </svg>
      <h3 class="text-lg font-medium text-gray-800 mb-2">Pendaftaran Ditutup</h3>
      <p class="text-gray-600">Pendaftaran untuk pelatihan ini sudah ditutup.</p>
    </div>
    <% } %>
  </div>
  <% } else { %>
  <div class="bg-white rounded-lg shadow p-8 text-center">
    <h3 class="text-lg font-medium text-gray-900 mb-2">Pelatihan Tidak Ditemukan</h3>
    <p class="text-gray-500 mb-4">Pelatihan yang Anda cari tidak tersedia.</p>
    <a href="/guru/daftar-pelatihan" class="text-blue-600 hover:text-blue-800">Kembali ke Daftar Pelatihan</a>
  </div>
  <% } %>
</div>
