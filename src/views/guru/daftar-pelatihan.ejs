<!-- Guru Daftar Pelatihan -->
<div class="p-4 md:p-6">
  <!-- Page Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Daftar Pelatihan</h1>
    <p class="text-gray-600 mt-1">Pilih pelatihan yang ingin Anda ikuti</p>
  </div>

  <!-- Registration Limit Info -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
    <div class="flex items-center">
      <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span class="text-blue-800">
        Pendaftaran tahun ini: <strong><%= registrationsThisYear %> / <%= maxRegistrations %></strong>
        <% if (!canRegister) { %>
        <span class="text-red-600 ml-2">(Batas maksimal tercapai)</span>
        <% } %>
      </span>
    </div>
  </div>

  <!-- Alert Messages -->
  <% if (typeof success !== 'undefined' && success) { %>
  <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline"><%= success %></span>
  </div>
  <% } %>
  
  <% if (typeof error !== 'undefined' && error) { %>
  <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline"><%= error %></span>
  </div>
  <% } %>

  <!-- Pelatihan List -->
  <% if (kuotaList && kuotaList.length > 0) { %>
  <div class="grid gap-4 md:gap-6">
    <% kuotaList.forEach(function(kuota) { %>
    <div class="bg-white rounded-lg shadow p-4 md:p-6">
      <div class="flex flex-col md:flex-row md:items-start md:justify-between">
        <div class="flex-1">
          <h3 class="text-lg font-semibold text-gray-800"><%= kuota.judul_pelatihan || 'Pelatihan ' + kuota.tahun_ajaran %></h3>
          <p class="text-gray-600 mt-1"><%= kuota.deskripsi || 'Program pelatihan P4 Jakarta Timur' %></p>
          
          <div class="mt-3 space-y-1 text-sm text-gray-600">
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <span>
                <% if (kuota.tanggal_mulai && kuota.tanggal_selesai) { %>
                <%= new Date(kuota.tanggal_mulai).toLocaleDateString('id-ID') %> - <%= new Date(kuota.tanggal_selesai).toLocaleDateString('id-ID') %>
                <% } else { %>
                Tahun Ajaran <%= kuota.tahun_ajaran %>
                <% } %>
              </span>
            </div>
            <% if (kuota.waktu_pelatihan) { %>
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span><%= kuota.waktu_pelatihan %></span>
            </div>
            <% } %>
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              <span>Target: 
                <% if (kuota.target_peserta === 'guru') { %>
                Pendidik/Tenaga Kependidikan
                <% } else if (kuota.target_peserta === 'peserta') { %>
                Peserta Didik
                <% } else { %>
                Semua
                <% } %>
              </span>
            </div>
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
              </svg>
              <span>Kuota: <%= kuota.peserta_terdaftar || 0 %> / <%= kuota.max_peserta %> peserta</span>
            </div>
          </div>
        </div>
        
        <div class="mt-4 md:mt-0 md:ml-6">
          <% if (kuota.status === 'open' && canRegister) { %>
          <button type="button" data-kuota-id="<%= kuota.id %>" class="daftar-btn w-full md:w-auto px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            Daftar
          </button>
          <% } else if (!canRegister) { %>
          <span class="inline-block px-4 py-2 bg-gray-200 text-gray-600 rounded-lg">Batas Tercapai</span>
          <% } else { %>
          <span class="inline-block px-4 py-2 bg-gray-200 text-gray-600 rounded-lg">Pendaftaran Ditutup</span>
          <% } %>
        </div>
      </div>
    </div>
    <% }); %>
  </div>
  <% } else { %>
  <div class="bg-white rounded-lg shadow p-8 text-center">
    <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
    </svg>
    <h3 class="text-lg font-medium text-gray-900 mb-2">Tidak Ada Pelatihan Tersedia</h3>
    <p class="text-gray-500">Saat ini tidak ada pelatihan yang tersedia untuk pendaftaran.</p>
  </div>
  <% } %>
</div>

<!-- Registration Modal -->
<div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 items-center justify-center p-4">
  <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Konfirmasi Pendaftaran</h3>
    <form id="registerForm" action="" method="POST" enctype="multipart/form-data">
      <div class="mb-4">
        <label for="surat_tugas" class="block text-sm font-medium text-gray-700 mb-2">
          Upload Surat Tugas <span class="text-red-500">*</span>
        </label>
        <input type="file" id="surat_tugas" name="surat_tugas" required accept=".pdf,.jpg,.jpeg,.png"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <p class="mt-1 text-xs text-gray-500">Format: PDF, JPG, PNG. Maksimal 5MB</p>
      </div>
      
      <div class="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4">
        <p class="text-sm text-yellow-800">
          <strong>Perhatian:</strong> Pastikan surat tugas sudah ditandatangani oleh kepala sekolah/pimpinan instansi.
        </p>
      </div>

      <div class="flex justify-end space-x-3">
        <button type="button" id="closeModalBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
          Batal
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          Daftar Sekarang
        </button>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const modal = document.getElementById('registerModal');
  const registerForm = document.getElementById('registerForm');
  const closeModalBtn = document.getElementById('closeModalBtn');
  
  function openModal(kuotaId) {
    registerForm.action = '/guru/daftar-pelatihan';
    registerForm.innerHTML = `
      <input type="hidden" name="kuota_id" value="${kuotaId}">
      <div class="mb-4">
        <label for="surat_tugas" class="block text-sm font-medium text-gray-700 mb-2">
          Upload Surat Tugas <span class="text-red-500">*</span>
        </label>
        <input type="file" id="surat_tugas" name="surat_tugas" required accept=".pdf,.jpg,.jpeg,.png"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <p class="mt-1 text-xs text-gray-500">Format: PDF, JPG, PNG. Maksimal 5MB</p>
      </div>
      
      <div class="bg-yellow-50 border border-yellow-200 rounded p-3 mb-4">
        <p class="text-sm text-yellow-800">
          <strong>Perhatian:</strong> Pastikan surat tugas sudah ditandatangani oleh kepala sekolah/pimpinan instansi.
        </p>
      </div>

      <div class="flex justify-end space-x-3">
        <button type="button" id="closeModalBtnDynamic" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
          Batal
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          Daftar Sekarang
        </button>
      </div>
    `;
    
    // Add event listener to dynamically created close button
    const dynamicCloseBtn = document.getElementById('closeModalBtnDynamic');
    if (dynamicCloseBtn) {
      dynamicCloseBtn.addEventListener('click', closeModal);
    }
    
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }
  
  function closeModal() {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }
  
  // Event listeners for all "Daftar" buttons
  document.querySelectorAll('.daftar-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      const kuotaId = this.getAttribute('data-kuota-id');
      openModal(kuotaId);
    });
  });
  
  // Event listener for initial close button
  if (closeModalBtn) {
    closeModalBtn.addEventListener('click', closeModal);
  }
  
  // Close modal when clicking outside
  modal.addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });
});
</script>
