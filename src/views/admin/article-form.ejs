<!-- Admin Article Form (Create/Edit) -->
<div class="p-4 md:p-6">
  <!-- Page Header -->
  <div class="flex items-center mb-6">
    <a href="/admin/articles" class="mr-4 text-gray-600 hover:text-gray-900">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
    </a>
    <div>
      <h1 class="text-2xl font-bold text-gray-800">
        <%= typeof article !== 'undefined' && article ? 'Edit Artikel' : 'Buat Artikel Baru' %>
      </h1>
    </div>
  </div>

  <% if (typeof errors !== 'undefined' && errors && errors.length > 0) { %>
  <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
    <ul class="list-disc list-inside">
      <% errors.forEach(function(error) { %>
      <li><%= error %></li>
      <% }); %>
    </ul>
  </div>
  <% } %>

  <!-- Article Form -->
  <div class="bg-white rounded-lg shadow p-6">
    <form action="<%= typeof article !== 'undefined' && article && article.id ? '/admin/articles/' + article.id + '/update' : '/admin/articles/create' %>" method="POST" enctype="multipart/form-data">
      <div class="space-y-6">
        <!-- Title -->
        <div>
          <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Judul Artikel *</label>
          <input type="text" id="title" name="title" required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            value="<%= typeof article !== 'undefined' && article ? article.title : '' %>"
            placeholder="Masukkan judul artikel">
        </div>

        <!-- Content -->
        <div>
          <label for="content" class="block text-sm font-medium text-gray-700 mb-1">Konten Artikel *</label>
          <textarea id="content" name="content" rows="15" required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Tulis konten artikel di sini..."><%= typeof article !== 'undefined' && article ? article.content : '' %></textarea>
          <p class="mt-1 text-sm text-gray-500">Anda dapat menggunakan HTML dasar untuk formatting</p>
        </div>

        <!-- Upload Gambar -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Upload Gambar (Opsional)</label>
          <div id="dropZone" class="relative border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-blue-500 transition-colors cursor-pointer">
            <input type="file" id="imageUpload" name="image" accept="image/*" class="hidden">
            <div id="uploadPrompt" class="text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              <p class="mt-2 text-sm text-gray-600">
                <span class="font-semibold text-blue-600 hover:text-blue-500">Klik untuk upload</span> atau drag and drop
              </p>
              <p class="mt-1 text-xs text-gray-500">PNG, JPG, GIF hingga 10MB</p>
            </div>
            <div id="imagePreview" class="hidden">
              <img id="previewImg" src="" alt="Preview" class="max-h-48 mx-auto rounded-lg">
              <button type="button" id="removeImage" class="mt-3 px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors text-sm">
                Hapus Gambar
              </button>
            </div>
          </div>
          <% if (typeof article !== 'undefined' && article && (article.featured_image || article.image_url)) { %>
          <div class="mt-3">
            <p class="text-sm text-gray-500 mb-2">Gambar saat ini:</p>
            <img src="<%= article.featured_image || article.image_url %>" alt="Current" class="max-h-32 rounded-lg">
          </div>
          <% } %>
        </div>

        <!-- Status -->
        <div>
          <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Status Publikasi *</label>
          <select id="status" name="status" required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="draft" <%= typeof article !== 'undefined' && article && article.status === 'draft' ? 'selected' : '' %>>Draft</option>
            <option value="published" <%= typeof article !== 'undefined' && article && article.status === 'published' ? 'selected' : '' %>>Published (Tampilkan di Website)</option>
          </select>
          <p class="mt-1 text-sm text-gray-500">Pilih "Published" agar artikel muncul di halaman utama</p>
        </div>

        <!-- Submit Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 pt-4">
          <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            <%= typeof article !== 'undefined' && article ? 'Simpan Perubahan' : 'Buat Artikel' %>
          </button>
          <a href="/admin/articles" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-center">
            Batal
          </a>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
// Drag and Drop Image Upload
const dropZone = document.getElementById('dropZone');
const imageUpload = document.getElementById('imageUpload');
const uploadPrompt = document.getElementById('uploadPrompt');
const imagePreview = document.getElementById('imagePreview');
const previewImg = document.getElementById('previewImg');
const removeImageBtn = document.getElementById('removeImage');

// Click to upload
dropZone.addEventListener('click', () => {
  imageUpload.click();
});

// Prevent default drag behaviors
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
  dropZone.addEventListener(eventName, preventDefaults, false);
  document.body.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
  e.preventDefault();
  e.stopPropagation();
}

// Highlight drop zone when item is dragged over it
['dragenter', 'dragover'].forEach(eventName => {
  dropZone.addEventListener(eventName, () => {
    dropZone.classList.add('border-blue-500', 'bg-blue-50');
  }, false);
});

['dragleave', 'drop'].forEach(eventName => {
  dropZone.addEventListener(eventName, () => {
    dropZone.classList.remove('border-blue-500', 'bg-blue-50');
  }, false);
});

// Handle dropped files
dropZone.addEventListener('drop', (e) => {
  const dt = e.dataTransfer;
  const files = dt.files;
  handleFiles(files);
}, false);

// Handle selected files
imageUpload.addEventListener('change', (e) => {
  handleFiles(e.target.files);
});

// Handle files
function handleFiles(files) {
  if (files.length === 0) return;
  
  const file = files[0];
  
  // Validate file type
  if (!file.type.startsWith('image/')) {
    alert('File harus berupa gambar');
    return;
  }
  
  // Validate file size (10MB)
  if (file.size > 10 * 1024 * 1024) {
    alert('Ukuran file maksimal 10MB');
    return;
  }
  
  // Preview image
  const reader = new FileReader();
  reader.onload = (e) => {
    previewImg.src = e.target.result;
    uploadPrompt.classList.add('hidden');
    imagePreview.classList.remove('hidden');
  };
  reader.readAsDataURL(file);
}

// Remove image
removeImageBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  imageUpload.value = '';
  previewImg.src = '';
  uploadPrompt.classList.remove('hidden');
  imagePreview.classList.add('hidden');
});
</script>
